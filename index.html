# =================================================================
# [í•œ/ë¯¸ êµ­ì±„ ê¸ˆë¦¬ ì¥ê¸° ì¶”ì´ ì‹œê°í™” ë„êµ¬]
# ì‹¤í–‰ ì „ í„°ë¯¸ë„ì—ì„œ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•˜ì„¸ìš”:
# pip install finance-datareader matplotlib pandas
# =================================================================

import FinanceDataReader as fdr
import matplotlib.pyplot as plt
import pandas as pd
from datetime import datetime

def run_bond_analysis():
    # 1. ê¸°ê°„ ì„¤ì • (ë°ì´í„° ì‹œì‘ ì‹œì ë¶€í„° ì˜¤ëŠ˜ê¹Œì§€)
    today = datetime.now().strftime('%Y-%m-%d')
    start_date = '1900-01-01'  # ì•„ì£¼ ë¨¼ ê³¼ê±°ë¡œ ì„¤ì •í•˜ì—¬ ì „ì²´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´

    print(f"ğŸ“Š ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤... (ê¸°ì¤€ì¼: {today})")

    # 2. ìˆ˜ì§‘ ëŒ€ìƒ ì‹¬ë³¼ (Investing.com ë°ì´í„° ì†ŒìŠ¤ í™œìš©)
    symbols = {
        'KR 3Y': 'KR3YT=RR',   # í•œêµ­ êµ­ì±„ 3ë…„ë¬¼ ìˆ˜ìµë¥ 
        'KR 10Y': 'KR10YT=RR', # í•œêµ­ êµ­ì±„ 10ë…„ë¬¼ ìˆ˜ìµë¥ 
        'US 2Y': 'US2YT=RR',   # ë¯¸êµ­ êµ­ì±„ 2ë…„ë¬¼ ìˆ˜ìµë¥ 
        'US 10Y': 'US10YT=RR'  # ë¯¸êµ­ êµ­ì±„ 10ë…„ë¬¼ ìˆ˜ìµë¥ 
    }

    # 3. ë°ì´í„° ë¡œë“œ ë° í†µí•©
    yield_df = pd.DataFrame()

    for name, symbol in symbols.items():
        try:
            # ë°ì´í„° ìˆ˜ì§‘
            temp_df = fdr.DataReader(symbol, start_date, today)['Close']
            temp_df.name = name
            # ê¸°ì¡´ ë°ì´í„°ì™€ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ë³‘í•©
            yield_df = pd.concat([yield_df, temp_df], axis=1)
            print(f"âœ… {name}: ë¡œë“œ ì™„ë£Œ (ì‹œì‘ì¼: {temp_df.index[0].date()})")
        except Exception as e:
            print(f"âŒ {name} ë¡œë“œ ì‹¤íŒ¨: {e}")

    # 4. ì‹œê°í™” ì„¤ì • (í•˜ë‚˜ì˜ íŒŒì¼ ë‚´ì—ì„œ ëª¨ë“  ì„¤ì • ì™„ë£Œ)
    plt.figure(figsize=(15, 8))
    plt.style.use('bmh') # ê¹”ë”í•œ ì‹œê°í™” ìŠ¤íƒ€ì¼

    # í•œêµ­ êµ­ì±„ (Blue ê³„ì—´)
    if 'KR 3Y' in yield_df.columns:
        plt.plot(yield_df.index, yield_df['KR 3Y'], label='South Korea 3Y', color='#3498db', linewidth=1.2)
    if 'KR 10Y' in yield_df.columns:
        plt.plot(yield_df.index, yield_df['KR 10Y'], label='South Korea 10Y', color='#2c3e50', linewidth=2, linestyle='--')

    # ë¯¸êµ­ êµ­ì±„ (Red ê³„ì—´)
    if 'US 2Y' in yield_df.columns:
        plt.plot(yield_df.index, yield_df['US 2Y'], label='US 2Y', color='#e74c3c', linewidth=1.2)
    if 'US 10Y' in yield_df.columns:
        plt.plot(yield_df.index, yield_df['US 10Y'], label='US 10Y', color='#8b0000', linewidth=2, linestyle='--')

    # ì°¨íŠ¸ ê¾¸ë¯¸ê¸°
    plt.title(f'Historical Bond Yields: South Korea vs US (Up to {today})', fontsize=16, fontweight='bold', pad=20)
    plt.ylabel('Yield (%)', fontsize=12)
    plt.xlabel('Year', fontsize=12)
    plt.legend(loc='upper right', frameon=True, shadow=True)
    plt.grid(True, linestyle=':', alpha=0.6)

    # 5. ì €ì¥ ë° ì¶œë ¥
    file_name = 'bond_yield_all_in_one.png'
    plt.tight_layout()
    plt.savefig(file_name, dpi=300)
    
    print("-" * 50)
    print(f"âœ¨ ë¶„ì„ ê²°ê³¼ê°€ '{file_name}' íŒŒì¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")
    print("-" * 50)
    
    plt.show()

if __name__ == "__main__":
    run_bond_analysis()
